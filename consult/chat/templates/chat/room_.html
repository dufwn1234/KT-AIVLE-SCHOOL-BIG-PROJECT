{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <!-- Viewport-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <!-- SEO Meta Tags-->
    <meta name="keywords" content="quicky, chat, messenger, conversation, social, communication" />
    <meta name="description" content="저희는 kt aivle school 빅프로젝트~~~~~~~~~~~~~~~~~~~~" />
    <meta name="subject" content="communication">
    <meta name="copyright" content="frontendmatters">
     <meta name="revised" content="Tuesday, November 10th, 2020, 08:00 am" />
    <title>Consult chat</title>
    <!-- Favicon and Touch Icons-->
    <link rel="icon" type="image/png" sizes="32x32" href="{%static "assets/img/favicons/favicon-96x96.png" %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{%static "assets/img/favicons/favicon-32x32.png" %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{%static "assets/img/favicons/favicon-16x16.png" %}">
    <link rel="shortcut icon" type="image/x-icon" href="{%static "assets/img/favicons/favicon.ico" %}">
    <link rel="manifest" href="{%static "assets/img/favicons/manifest.json" %}">
    <meta name="msapplication-TileImage" content="{%static "assets/img/favicons/ms-icon-150x150.png" %}">
    <meta name="theme-color" content="#ffffff"> 

    <link href="{% static "assets/css/theme.css" %}" rel="stylesheet" />
    <link rel="stylesheet" href='{% static "webfonts/inter/inter.css" %}'> 
    <link rel="stylesheet" href='{% static "css/app.min.css" %}'>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.2.0/tailwind.min.css'>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&display=swap" rel="stylesheet">

    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/1.2.0/tailwind.min.css'>
    <link rel="mask-icon" type="image/x-icon" href="https://cpwebassets.codepen.io/assets/favicon/logo-pin-b4b4269c16397ad2f0f7a01bcdf513a1994f4c94b8af2f191c09eb0d601762b1.svg" color="#111" />

    <link rel="canonical" href="https://codepen.io/cuonoj/pen/LYVzVYP" />

<style>
    body {
        font-family: 'Varela Round', sans-serif;
    }
    .accordion-button {
        position: relative;
        display: flex;
        align-items: center;
        width: 100%;
        height:60px;
        padding: 0.79rem 1.125rem;
        font-size: 15px;
        color: #566a7f;
        text-align: left;
        background-color: #fff;
        border: 0;
        border-radius: 10px;
        overflow-anchor: none;
        transition: all 0.2s ease-in-out, border-radius 0.15s ease;
        font-family: 'Noto Sans KR';
      }
    .accordion-collapse {
        border-radius: 10px;
        font-size: 15px;
        font-family: 'Noto Sans KR';
      }

    .accordion-body {
        border-radius: 10px;
      }
    
    .accordion-header {
        margin-bottom: 8px;
      }
    .modal-confirm {		
        color: #636363;
        width: 550px;
    }
    .modal-confirm .modal-content {
        padding: 20px;
        border-radius: 5px;
        border: none;        
    }
    .modal-confirm .modal-header {
        padding: 0 15px;
        border-bottom: none;   
        position: relative;
    }
    .modal-confirm h4 {
        display: inline-block;
        font-size: 26px;
    }
    .modal-confirm .close {
        position: absolute;
        top: -5px;
        right: -5px;
    }
    .modal-confirm .modal-body ul {
        list-style-type: disc;
        padding-left: 20px;
    }
    .modal-confirm .modal-body ul li {
        margin-bottom: 10px; /* Increased gap between list items */
    }

    .modal-confirm .modal-header .close {
        display: none;
    }

    .modal-confirm .modal-content {
        border: 1px solid #CECDCD;
    }

    .modal-backdrop.show {
        background-color: rgba(0, 0, 0, 0.6);
    }

    .modal-confirm .modal-body {
        color: #999;
    }

    .modal {
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }
    .modal-confirm .modal-footer {
        background: #ecf0f1;
        border-color: #e6eaec;
        text-align: right;
        margin: 0 -20px -20px;
        border-radius: 0 0 5px 5px;
    }	
    .modal-confirm .btn {
        color: #fff;
        border-radius: 4px;
        transition: all 0.4s;
        border: none;
        padding: 8px 20px;
        outline: none !important;
    }	
    .modal-confirm .btn-info {
        background: #b0c1c6;
    }
    .modal-confirm .btn-info:hover, .modal-confirm .btn-info:focus {
        background: #92a9af;
    }
    .modal-confirm .btn-danger {
        background: #f15e5e;
    }
    .modal-confirm .btn-danger:hover, .modal-confirm .btn-danger:focus {
        background: #ee3535;
    }
    .modal-confirm .modal-footer .btn + .btn {
        margin-left: 10px;
    }
    .trigger-btn {
        display: inline-block;
        margin: 100px auto;
    }
    
    </style>
    
    <script>
    window.console = window.console || function(t) {};
    </script>
</head>

<body class="chats-tab-open">

    <!-- Main Layout Start -->
    <div class="main-layout">
        <!-- Navigation Start -->
        <div class="navigation navbar navbar-light bg-primary">
            <!-- Logo Start -->
            <a class="d-none d-xl-block bg-light rounded p-1" href='/'>
                <!-- Default :: Inline SVG -->
                <svg height="30" width="30" viewBox="0 0 24 24">
                    <path d="M21 9.172V21H3V9.172L12 2.828l9 6.344zM14 19h-4v-4h4v4z" fill="#6f42c1" />
                  </svg>
            </a>
            <!-- Logo End -->

            <!-- Main Nav Start -->
            <ul class="nav nav-minimal flex-row flex-grow-1 justify-content-between flex-xl-column justify-content-xl-center" role="tablist">
                <!-- Chats Tab Start -->
                <li class="nav-item">
                    <a class="nav-link p-0 py-xl-3 active" href="/chat/" title="Chats">
                        <!-- Default :: Inline SVG -->
                        <svg class="hw-24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8h2a2 2 0 012 2v6a2 2 0 01-2 2h-2v4l-4-4H9a1.994 1.994 0 01-1.414-.586m0 0L11 14h4a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2v4l.586-.586z"/>
                        </svg>
                    </a>
                </li>
                <!-- Chats Tab End -->

                <!-- Calls Tab Start -->
                <li class="nav-item">
                    <a class="nav-link p-0 py-xl-3 " href="/voicetalk/" title="Voice">
                        <!-- Default :: Inline SVG -->
                        <svg class="hw-24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                        </svg>
                    </a>
                </li>
                <!-- Calls Tab End -->
             

            </ul>
            <!-- Main Nav End -->
        </div>
        <!-- Navigation End -->

        <!-- Sidebar Start -->
        <aside class="sidebar">
            <!-- Tab Content Start -->
            <div class="tab-content">
                <!-- Chat Tab Content Start -->
                <div class="tab-pane active" id="chats-content">
                    <div class="d-flex flex-column h-100">
                        <div class="hide-scrollbar h-100" id="chatContactsList">
                            
                            <!-- Chat Header Start -->
                            <div class="sidebar-header sticky-top p-2">

                                <div class="d-flex justify-content-between align-items-center">
                                    <!-- Chat Tab Pane Title Start -->
                                    {% if request.user.member_type == 'Counselor' %}
                                        <h5 class="font-weight-semibold mb-0" style="font-family: 'Noto Sans KR';">상담사 매뉴얼</h5>
                                    {% elif request.user.member_type == 'Customer' %}
                                        <h5 class="font-weight-semibold mb-0">FAQ</h5>
                                    {% endif %}
                                    
                                    <!-- Chat Tab Pane Title End -->
                                    <ul class="nav flex-nowrap">
                                        <li class="nav-item list-inline-item d-block d-xl-none mr-1">
                                            <a class="nav-link text-muted px-1" href="#" title="Appbar" data-toggle-appbar="">
                                                <!-- Default :: Inline SVG -->
                                                <svg class="hw-20" fill="none" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" viewBox="0 0 24 24" stroke="currentColor"><path d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"></path></svg>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                                <!-- Sidebar Header End -->

                            </div>
                            <!-- Chat Header End -->

                            <!-- Chat Contact List Start -->
                            <ul class="contacts-list" id="chatContactTab" data-chat-list="">
                                <!-- Chat Item Start -->

                                <!-- user가 Counselor 경우, 고객 상담 이력 보이도록 -->
                                {% if request.user.member_type == 'Counselor' %}

                                    <!-- 고객 정보 모두 출력(임시) -->
                                    <!--
                                    {% for c in customers %}
                                        <li class="contacts-item friends">
                                            <div class="avatar d-none d-sm-inline-block mr-3 {% if c.chat_active %}avatar-online{% else %}avatar-offline{% endif %}">
                                                <img class="avatar-img" {% if c.image %}src={{ c.image.url }}{% else %}src="{% static 'images/user_default_image.png' %}" {% endif %} alt="">
                                            </div>
                                            <div class="contacts-content">
                                                <div class="contacts-info">
                                                    <h6 class="chat-name text-truncate">{{ c.username }}</h6>
                                                    <div class="chat-time">{{ c.nation }}</div>
                                                </div>
                                                <div class="contacts-texts">
                                                    <p class="text-truncate">{{ c.phone_number }}</p>
                                                </div>
                                            </div>
                                        </li>

                                        {% for call in calls %}
                                            {% if call.customer_id == c.id %}
                                                <li class="contacts-item friends">
                                                    <div class="contacts-content">
                                                        <div class="contacts-info">
                                                            <h6 class="chat-name text-truncate">{{ call.title }}</h6>
                                                            <div class="chat-time">Call({{ call.counselor.username }})</div>
                                                        </div>
                                                        <div class="contacts-texts">
                                                            <p class="text-truncate">{{ call.summary }}</p>
                                                        </div>
                                                        <div class="contacts-texts">
                                                            <p class="text-truncate">{{ call.consult_date }}</p>
                                                        </div>
                                                    </div>
                                                </li>
                                            {% endif %}
                                        {% endfor %}

                                    {% endfor %}
                                    -->
                                    <p id='customer-username-save' style="display:none;"></p>

                                    <!-- cutomser 정보 없을 경우 -->
                                    {% if customer is None %}
                                        {% comment %} <li class="contacts-item friends">
                                            <div class="contacts-texts">
                                                <p class="text-truncate">상담 목록이 존재하지 않습니다.</p>
                                            </div>
                                        </li> {% endcomment %}

                                        <div class="card accordion-item active">
                                            <h2 class="accordion-header" id="headingOne">
                                              <button
                                                type="button"
                                                class="accordion-button"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#accordionOne"
                                                aria-expanded="true"
                                                aria-controls="accordionOne"
                                              >
                                                  1. 상담 시작
                                              </button>
                                            </h2>
                      
                                            <div
                                              id="accordionOne"
                                              class="accordion-collapse collapse show"
                                              data-bs-parent="#accordionExample">
                                              <div class="accordion-body">
                                                  - 안녕하십니까 고객님, ㅇㅇㅇ 상담사입니다.
                                              </div>
                                            </div>
                                          </div>
                                          <div class="card accordion-item">
                                            <h2 class="accordion-header" id="headingTwo">
                                              <button
                                                type="button"
                                                class="accordion-button collapsed"
                                                data-bs-toggle="collapse"
                                                data-bs-target="#accordionTwo"
                                                aria-expanded="false"
                                                aria-controls="accordionTwo"
                                              >
                                                  2. 문제 파악
                                              </button>
                                            </h2>
                                            <div
                                              id="accordionTwo"
                                              class="accordion-collapse collapse"
                                              aria-labelledby="headingTwo"
                                              data-bs-parent="#accordionExample"
                                            >
                                              <div class="accordion-body">
                                                  - 무엇을 도와드릴까요?
                                              </div>
                                            </div>
                                          </div>
                                          <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading3">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion3"
                                                  aria-expanded="false"
                                                  aria-controls="accordion3"
                                                >
                                                  3. 고객 이해
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion3"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading3"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                  - 고객님이 겪고 있는 문제를 자세히 설명해주실 수 있으신가요?
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading4">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion4"
                                                  aria-expanded="false"
                                                  aria-controls="accordion4"
                                                >
                                                  4. 문제 해결
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion4"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading4"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                  - 고객님의 문제를 해결하기 위해 다음과 같은 방법을 제안해드릴게요.
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading5">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion5"
                                                  aria-expanded="false"
                                                  aria-controls="accordion5"
                                                >
                                                  5. 추가 지원
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion5"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading5"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                  - 문제를 해결하는 데 도움이 될 수 있는 관련 자료를 제공해드리겠습니다.
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading6">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion6"
                                                  aria-expanded="false"
                                                  aria-controls="accordion6"
                                                >
                                                  6. 만족도 조사 설명
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion6"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading6"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                  - 상담이 끝난 이후 만족도 조사에 참여해주세요.
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading7">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion7"
                                                  aria-expanded="false"
                                                  aria-controls="accordion7"
                                                >
                                                  7. 상담 마무리
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion7"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading7"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                    - 다른 문제가 있을 경우 언제든지 연락주세요. 이상 ㅇㅇㅇ 상담사였습니다.
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading8">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion8"
                                                  aria-expanded="false"
                                                  aria-controls="accordion8"
                                                >
                                                  + 대기 시간 안내
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion8"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading8"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                    - 현재 상담이 밀려 지연되고 있습니다. 조금만 기다려 주시면 신속하게 상담 도와드릴게요.
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading9">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion9"
                                                  aria-expanded="false"
                                                  aria-controls="accordion9"
                                                >
                                                  + 서비스 안내
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion9"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading9"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                    - 저희 센터에서 제공하는 서비스에 대해 알려드릴게요.
                                                </div>
                                              </div>
                                            </div>
                                            <div class="card accordion-item">
                                              <h2 class="accordion-header" id="heading10">
                                                <button
                                                  type="button"
                                                  class="accordion-button collapsed"
                                                  data-bs-toggle="collapse"
                                                  data-bs-target="#accordion10"
                                                  aria-expanded="false"
                                                  aria-controls="accordion10"
                                                >
                                                  + 문제 미해결
                                                </button>
                                              </h2>
                                              <div
                                                id="accordion10"
                                                class="accordion-collapse collapse"
                                                aria-labelledby="heading10"
                                                data-bs-parent="#accordionExample"
                                              >
                                                <div class="accordion-body">
                                                    - 죄송합니다 고객님. 해당 부분 확인 후 바로 전달드리겠습니다.
                                                </div>
                                              </div>
                                            </div>
                                    
                                    <!-- customer 정보 있을 경우, 상담 이력 출력 -->
                                    {% else %}
                                        {% for call in calls %}
                                            {% if call.customer_id == customer.id %}
                                                <li class="contacts-item friends">
                                                    <div class="contacts-content">
                                                        <div class="contacts-info">
                                                            <h6 class="chat-name text-truncate">{{ call.title }}</h6>
                                                            <div class="chat-time">Call({{ call.counselor.username }})</div>
                                                        </div>
                                                        <div class="contacts-texts">
                                                            <p class="text-truncate">{{ call.summary }}</p>
                                                        </div>
                                                        <div class="contacts-texts">
                                                            <p class="text-truncate">{{ call.consult_date }}</p>
                                                        </div>
                                                    </div>
                                                </li>
                                            {% endif %}
                                        {% endfor %} 
                                    {% endif %}

                                <!-- user가 Customer일 경우, FAQ 보이게 -->
                                {% elif request.user.member_type == 'Customer' %}
                                    {% for faq in faqs %}
                                    <div class="card accordion-item">
                                        <h2 class="accordion-header" id="heading{{ forloop.counter }}">
                                            <button
                                            type="button"
                                            class="accordion-button collapsed"
                                            data-bs-toggle="collapse"
                                            data-bs-target="#accordion{{ forloop.counter }}"
                                            aria-expanded="false"
                                            aria-controls="accordion{{ forloop.counter }}"
                                            >
                                            Q. &nbsp; {{ faq.title }}
                                            </button>
                                        </h2>
                                        <div
                                            id="accordion{{ forloop.counter }}"
                                            class="accordion-collapse collapse"
                                            aria-labelledby="heading{{ forloop.counter }}"
                                            data-bs-parent="#accordionExample"
                                        >
                                            <div class="accordion-body">
                                            {{ faq.detail|safe }}
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                                {% endif %}
                            </div>
                            <!-- Chat Contact List End -->

            </div>
            <!-- Tab Content End -->
        </aside>
        <!-- Sidebar End -->

        <!-- Main Start -->
        <main class="main main-visible">

            <!-- Chats Page Start -->
            <div class="chats">
                <div class="chat-body">

                    <!-- Chat Header Start-->
                    <div class="chat-header">
                        <!-- Chat Back Button (Visible only in Small Devices) -->
                        <button class="btn btn-secondary btn-icon btn-minimal btn-sm text-muted d-xl-none" type="button" data-close="">
                            <!-- Default :: Inline SVG -->
                            <svg class="hw-20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                            </svg>
                        </button>

                        <!-- Chat participant's Name -->
                        <!-- Counselor인 경우, Customer 정보 보이도록-->
                        {% if request.user.member_type == 'Counselor' %}
                            <!-- <div class="media chat-name align-items-center text-truncate">
                                <div class="avatar d-none d-sm-inline-block mr-3 avatar-offline">
                                    <img class="avatar-img" src="{% static 'images/user_default_image.png' %}" alt="">
                                </div>

                                <div class="media-body align-self-center ">
                                    <h6 class="text-truncate mb-0">상대 없음</h6>
                                    <small class="text-muted">오프라인</small>
                                </div>
                            </div> 
                            {% for c in customers %}
                                    <div class="media chat-name align-items-center text-truncate">
                                        <div class="avatar d-none d-sm-inline-block mr-3 {% if c.chat_active %}avatar-online{% else %}avatar-offline{% endif %}" id="customer-img-div">
                                            <img class="avatar-img" {% if c.image %}src={{ c.image.url }}{% else %}src="{% static 'images/user_default_image.png' %}" {% endif %} alt="" id="customer-img">
                                        </div>

                                        <div class="media-body align-self-center ">
                                            <h6 class="text-truncate mb-0" id="customer-info-name">{{ c.username }}</h6>
                                            <small class="text-muted" id="customer-info-active">{% if c.chat_active %}온라인{% else %}오프라인{% endif %}</small>
                                        </div>
                                    </div>

                                    <div class="media chat-name align-items-center text-truncate">
                                        <div class="avatar d-none d-sm-inline-block mr-3 avatar-offline">
                                            <img class="avatar-img" src="{% static 'images/user_default_image.png' %}" alt="">
                                        </div>

                                        <div class="media-body align-self-center ">
                                            <h6 class="text-truncate mb-0">상대 없음</h6>
                                            <small class="text-muted">오프라인</small>
                                        </div>
                                    </div> 
                            {% endfor %}  -->
                            
                            {% if customer is None %}
                                <div class="media chat-name align-items-center text-truncate">
                                    <div class="avatar d-none d-sm-inline-block mr-3 avatar-offline">
                                        <img class="avatar-img" src="{% static 'images/user_default_image.png' %}" alt="">
                                    </div>

                                    <div class="media-body align-self-center ">
                                        <h6 class="text-truncate mb-0">상대 없음</h6>
                                        <small class="text-muted">오프라인</small>
                                    </div>
                                </div>
                            {% else%}
                                <div class="media chat-name align-items-center text-truncate">
                                    <div class="avatar d-none d-sm-inline-block mr-3 {% if customer.chat_active %}avatar-online{% else %}avatar-offline{% endif %}" id="customer-img-div">
                                        <img class="avatar-img" {% if customer.image %}src={{ customer.image.url }}{% else %}src="{% static 'images/user_default_image.png' %}" {% endif %} alt="" id="customer-img">
                                    </div>

                                    <div class="media-body align-self-center ">
                                        <h6 class="text-truncate mb-0" id="customer-info-name">{{ customer.username }}</h6>
                                        <small class="text-muted" id="customer-info-active">{% if customer.chat_active %}온라인{% else %}오프라인{% endif %}</small>
                                    </div>
                                </div>
                            {% endif %}

                        <!-- Customer인 경우, Counselor 정보 보이도록 -->
                        {% elif request.user.member_type == 'Customer' %}
                            <div class="media chat-name align-items-center text-truncate">
                                <div class="avatar d-none d-sm-inline-block mr-3 {% if counselor.chat_active %}avatar-online{% else %}avatar-offline{% endif %}">
                                    <img class="avatar-img" {% if counselor.image %}src={{ counselor.image.url }}{% else %}src="{% static 'images/user_default_image.png' %}" {% endif %} alt="">
                                </div>

                                <div class="media-body align-self-center ">
                                    <h6 class="text-truncate mb-0">{{ counselor.username }}</h6>
                                    <small class="text-muted">{% if counselor.chat_active %}온라인{% else %}오프라인{% endif %}</small>
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    <!-- Chat Header End-->

                    <!-- Search Start -->
                    <div class="collapse border-bottom px-3" id="searchCollapse">
                        <div class="container-xl py-2 px-0 px-md-3">
                            <div class="input-group bg-light ">
                                <input type="text" class="form-control form-control-md border-right-0 transparent-bg pr-0" placeholder="Search">
                                <div class="input-group-append">
                                    <span class="input-group-text transparent-bg border-left-0">
                                        <!-- Default :: Inline SVG -->
                                        <svg class="hw-20 text-muted" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                                        </svg>
                                    </span>
                                </div>
                            </div>
                        </div>
                        
                    </div>
                    <!-- Search End -->

                    <!-- 상담 종료 버튼 -->

                        <a {% if request.user.member_type == 'Customer' %}href="{% url 'survey:submit' %}"
                        {% elif request.user.member_type == 'Counselor' %}href="{% url 'chat:chat_end' %}"{% endif %}
                        class="btn btn-primary"
                        style="position: fixed;
                        bottom: 5.5rem;
                        right: 5rem;
                        z-index: 999999;
                        box-shadow: 0 1px 20px 1px #696cff;"
                        >상담 종료</a>


                    <!-- Chat Content Start-->
                    <div class="chat-content p-2" id="messageBody">
                        <!--여기서 부터 삭제하면됨-->
						<div class="container" id="chat-log">
                            <div class="chat-notification">
                                <!--<div class="sl-nav label for="translation-language" > Translation 언어 선택:(고객은 한국어 default, 상담원은 고객 국적에 맞게 설정)</label>
                                <select id="translation-language">
                                    <option value="ko">한국어</option>
                                    <option value="en">English</option>
                                    <option value="ja">日本語</option>
                                    <option value="zh-CN">中文</option>
                                    <option value="th-TH">ภาษาไทย</option>
                                    <option value="vi-VN">Tiếng Việt</option>
                                </select>  -->
                            </div>
							<!-- 채팅 로그가 표시될 영역 -->
                            
                        </div> 
                        <!--여기 까지-->
						
						<!-- Scroll to finish -->
						<div class="chat-finished" id="chat-finished"></div>

					</div>
					<!-- Chat Content End-->
					
					<!-- Chat Footer Start-->
					<div class="chat-footer">
                        <textarea class="form-control emojionearea-form-control" id="messageInput" rows="1" placeholder="메세지를 작성해주세요"></textarea>
                        <div class="btn btn-primary btn-icon send-icon rounded-circle text-light mb-1" id="chat-message-submit" role="button">
                            <svg class="hw-24" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"/>
                            </svg>
                        </div>
					</div>
                </div>
            </div>
        </main>
        <!-- Main End -->

        <!-- App Add-ons Start -->
        <div class="appbar">
            <div class="appbar-wrapper hide-scrollbar">

                <!-- Chat Back Button (Visible only in Small Devices) -->
                <div class="d-flex justify-content-center border-bottom w-100">
                    <button class="btn btn-secondary btn-icon m-0 btn-minimal btn-sm text-muted d-xl-none" type="button" data-apps-close="">
                        <!-- Default :: Inline SVG -->
                        <svg class="hw-20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>

                    </button>
                </div>


                
                <!-- Appbar Nav End -->
            </div>

            <!-- Tab panes -->
            <div class="tab-content appnavbar-content">
                <div class="tab-pane h-100 active" id="app-welcome" role="tabpanel">
                    <div class="appnavbar-content-wrapper">
                        <div class="d-flex flex-column justify-content-center text-center h-100 w-100">
                            <div class="container">
                                <div class="avatar avatar-lg mb-2">
                                    <img class="avatar-img" src='{% static "media/avatar/4.png" %}' alt="">
                                </div>
    
        
                            </div>
                        </div>
                    </div>
                </div>

                

            </div>
        </div>
        <!-- App Add-ons End -->

            <div id="myModal" class="modal">
                <div class="modal-dialog modal-confirm">
                    <div class="modal-content">
                        <div class="modal-header">			
                            <h4 class="modal-title" id="modal-title">Warning</h4>	
                        </div>
                        <br>
                        <hr>
                        <br>
                        <p id="modal-text-0">지속적인 폭언시 다음과 같은 법적 처벌을 받을 수 있습니다:</p>
                        <div class="modal-body">
                            <ul>
                                <li id="modal-text-1">「형법」 제311조(모욕죄): 1년 이하의 징역이나 금고 또는 200만원 이하의 벌금</li>
                                <li id="modal-text-2">「형법」 제283조(협박죄): 3년 이하의 징역, 500만원 이하의 벌금, 구류 또는 과료</li>
                                <li id="modal-text-3">「형법」 제314조제1항(업무방해): 5년 이하의 징역 또는 1천500만원 이하의 벌금</li>
                                <li id="modal-text-4">「정보통신망 이용촉진 및 정보보호 등에 관한 법률」 제44조의7제제1항제3호(불법정보의 유통금지 등) 및 제74조제1항제3호(벌칙): 1년 이하의 징역 또는 1천만원 이하의 벌금</li>
                            </ul>
                        </div>
                        
                        <div class="modal-footer">
                            <button id="close" class="btn btn-danger">이해했습니다</button>
                        </div>
                    </div>
                </div>
            </div>

        <div class="backdrop"></div>
    </div>
    <!-- Main Layout End -->
	{{ room_name|json_script:"room-name" }}
	{{ user.username|json_script:"username" }}
	{{ user.id|json_script:"user_id" }}
    {{ user.nation|json_script:"user_nation" }}

    <!-- Javascript Files -->
    <script src='{% static "vendors/jquery/jquery-3.5.0.min.js" %}'></script>
    <script src='{% static "vendors/bootstrap/bootstrap.bundle.min.js" %}'></script>
    <script src='{% static "vendors/magnific-popup/jquery.magnific-popup.js" %}'></script>
    <script src='{% static "vendors/svg-inject/svg-inject.js" %}'></script>
    <script src='{% static "vendors/modal-stepes/modal-steps.min.js" %}'></script>
    <script src='{% static "/consult/workerschat/static/vendors/emojione/emojionearea.min.js" %}'></script>
    <script src='{% static "js/app.min.js" %}'></script>
    
    <script src="{% static "vendors/bootstrap/bootstrap.min.js" %}"></script>


    <script>
        // Scroll to end of chat
        document.querySelector('.chat-finished').scrollIntoView({
            block: 'end',               // "start" | "center" | "end" | "nearest",
            behavior: 'auto'          //"auto"  | "instant" | "smooth",
        });

    </script>

    <script>
		const roomName = JSON.parse(document.getElementById('room-name').textContent);
		const username = JSON.parse(document.getElementById('username').textContent);
		const user_id = JSON.parse(document.getElementById('user_id').textContent);
        const apiKey = 'AIzaSyAaQGwWd7MTIe5tCeeikiXzwXxLIKxI09M';
        const translationLanguage = document.querySelector("#translation-language");
        const targetLang = JSON.parse(document.getElementById('user_nation').textContent);

		const chatSocket = new WebSocket(
			'ws://' + window.location.host + '/ws/chat/' + roomName.replace(/"/g, '') + '/'
		);
	
		chatSocket.onopen = function (e) {
			fetchMessages();
		};

        chatSocket.onmessage = async function (e) {
            const data = JSON.parse(e.data);
          
            if (data['command'] === 'messages') {
              for (let i = 0; i < data['messages'].length; i++) {
                await createMessage(data['messages'][i]);
                await translateMessage(data['message'][i].message);
              }
            } else if (data['command'] === 'new_message') {
              await createMessage(data['message']); 
              await translateMessage(data['message'].message);
            }
          };


		chatSocket.onclose = function (e) {
			console.error('Chat socket closed unexpectedly');
		};
	
		document.querySelector('#messageInput').onkeyup = function (e) {
			if (e.keyCode === 13) {  // Enter key
				document.querySelector('#chat-message-submit').click();
			}
		};
	
		document.querySelector('#chat-message-submit').onclick = function (e) {
			const messageInputDom = document.querySelector('#messageInput');
			const message = messageInputDom.value;
			chatSocket.send(JSON.stringify({
				'message': message,
				'user': username,
				'user_id': user_id,
				'command': 'new_message'
			}));
			messageInputDom.value = '';
		};
	
		function fetchMessages() {
			chatSocket.send(JSON.stringify({
				'command': 'fetch_messages',
				'from': username
			}));
		}
		function scrollToBottom() {
			const chatContent = document.querySelector('#messageBody');
			chatContent.scrollTop = chatContent.scrollHeight;
		}


        // translation
        async function translateMessage(message) {
            // var selectedTranslationLanguage = translationLanguage.value;
            const response = await fetch(
                `https://translation.googleapis.com/language/translate/v2?key=${apiKey}`,
                {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    q: message,
                    target: getTargetLanguageCode(targetLang) 
                })
                }
            );

            const data = await response.json();
            const translatedText = data.data.translations[0].translatedText;
            return translatedText;
        }


        function getTargetLanguageCode(targetLang) {
            if (targetLang === 'Korean') {
                return 'ko';
            } else if (targetLang === 'English') {
                return 'en';
            } else if (targetLang === 'Japanese') {
                return 'ja';
            } else if (targetLang === 'Chinese') {
                return 'zh-CN';
            } else if (targetLang === 'Thai') {
                return 'th-TH';
            } else if (targetLang === 'Vietnamese') {
                return 'vi-VN';
            } 
        }
        async function createMessage(data) {
            const author = data['user'];
            let content = data['content'];

            if (author !== 'self') {
                if (content === '바른 말을 사용해주세요.') {
                  p_content = await translateMessage(content);
                }
              }
          
            if (author !== 'self') {
              content = await translateMessage(content);
            }

            if (author === username) {
                if (content === '바른 말을 사용해주세요.') {
                    const modal = document.getElementById("myModal");

                    let modal_title = document.getElementById("modal-title").innerText;
                    let modal_text0 = document.querySelector("#modal-text-0").innerText;
                    let modal_text1 = document.querySelector("#modal-text-1").innerText;
                    let modal_text2 = document.querySelector("#modal-text-2").innerText;
                    let modal_text3 = document.querySelector("#modal-text-3").innerText;
                    let modal_text4 = document.querySelector("#modal-text-4").innerText;
                    let modal_close = document.querySelector("#close").innerText;

                    document.getElementById("modal-title").innerText = await translateMessage(modal_title);
                    document.querySelector("#modal-text-0").innerText = await translateMessage(modal_text0);
                    document.querySelector("#modal-text-1").innerText = await translateMessage(modal_text1);
                    document.querySelector("#modal-text-2").innerText = await translateMessage(modal_text2);
                    document.querySelector("#modal-text-3").innerText = await translateMessage(modal_text3);
                    document.querySelector("#modal-text-4").innerText = await translateMessage(modal_text4);
                    document.querySelector("#close").innerText = await translateMessage(modal_close);

                    modal.style.display = "block";

                    const closeButton = document.getElementById("close");
                    closeButton.onclick = function () {
                        modal.style.display = "none";
                    }
                }
            }

            const chatLogDiv = document.querySelector('#chat-log');
          
            const chatLogDownDiv = document.createElement('div');
            chatLogDownDiv.classList.add('message');
            if (author === username) {
              chatLogDownDiv.classList.add('self');
            }
          
            const chatLogDownDownDiv = document.createElement('div');
            chatLogDownDownDiv.classList.add('message-wrapper');
          
            const chatLogDownDownDownDiv = document.createElement('div');
            chatLogDownDownDownDiv.classList.add('message-content');
            chatLogDownDownDownDiv.id = 'chat-message-div';
          
            const chatLogDownDownDownDownSpan = document.createElement('span');
            chatLogDownDownDownDownSpan.innerText = `${author}: ${content} `;
            if (author === username) {
              chatLogDownDownDownDownSpan.id = 'selfmessage';
            }
          
            chatLogDownDiv.appendChild(chatLogDownDownDiv);
            chatLogDownDownDiv.appendChild(chatLogDownDownDownDiv);
            chatLogDownDownDownDiv.appendChild(chatLogDownDownDownDownSpan);
          
            chatLogDiv.appendChild(chatLogDownDiv);
            scrollToBottom();
            
            if (author !== username && content === p_content ) {
              chatLogDownDiv.style.display = 'none'; 
            }


          }
          
          
          

        /*
        async function createMessage(data) {
            const author = data['user'];
            let content = data['content'];
            
            if (author !== 'self') {
                content = await translateMessage(content);
            }
            
            const chatLogDiv = document.querySelector('#chat-log');

            const chatLogDownDiv = document.createElement('div');
            chatLogDownDiv.classList.add('message');
            if (author === username) {
                chatLogDownDiv.classList.add('self');
            }
            
            chatLogDiv.appendChild(chatLogDownDiv);
            
            const chatLogDownDownDiv = document.createElement('div');
            chatLogDownDownDiv.classList.add('message-wrapper');
            chatLogDownDiv.appendChild(chatLogDownDownDiv);
            
            const chatLogDownDownDownDiv = document.createElement('div');
            chatLogDownDownDownDiv.classList.add('message-content');
            chatLogDownDownDownDiv.id = "chat-message-div";
            chatLogDownDownDiv.appendChild(chatLogDownDownDownDiv);
            
            const chatLogDownDownDownDownSpan = document.createElement('span');
            chatLogDownDownDownDownSpan.innerText = `${author}: ${content} `;
            if (author === username) {
                chatLogDownDownDownDownSpan.id = 'selfmessage';
            }
            else {
                chatLogDownDownDownDownSpan.id = 'chatmessage';
            }
            chatLogDownDownDownDiv.appendChild(chatLogDownDownDownDownSpan);
            scrollToBottom();  
        }
        */
          
        // 채팅 템플렛 적용 코드
        /*function createMessage(data) {
            const author = data['user'];
            const content = data['content'];

            const chatLogDiv = document.querySelector('#chat-log');

            const chatLogDownDiv = document.createElement('div');
            chatLogDownDiv.classList.add('message');
            if (author === username) {
                chatLogDownDiv.classList.add('self');
            }
            chatLogDiv.appendChild(chatLogDownDiv);

            const chatLogDownDownDiv = document.createElement('div');
            chatLogDownDownDiv.classList.add('message-wrapper');
            chatLogDownDiv.appendChild(chatLogDownDownDiv);

            const chatLogDownDownDownDiv = document.createElement('div');
            chatLogDownDownDownDiv.classList.add('message-content');
            chatLogDownDownDownDiv.id = "chat-message-div";
            chatLogDownDownDiv.appendChild(chatLogDownDownDownDiv);

            const chatLogDownDownDownDownSpan = document.createElement('span');
            chatLogDownDownDownDownSpan.innerText = `${author}: ${content} `;
            if (author === username) {
                chatLogDownDownDownDownSpan.id = 'selfmessage';
            }
            else {
                chatLogDownDownDownDownSpan.id = 'chatmessage';
            }
            chatLogDownDownDownDiv.appendChild(chatLogDownDownDownDownSpan);
            
            scrollToBottom();  
        }
        */

        // customer 정보 출력
        function showCustomerInfo(customer) {
            const author = customer;

            // customer 프로필 표시
            const customerImgDiv = document.querySelector('#customer-img-div');  // 온/오프라인 이미지 표시
            customerImgDiv.classList.remove('avatar-offline');
            customerImgDiv.classList.add('avatar-online');
            
            const customerImg = document.querySelector('#customer-img');  // 이미지 출력
            customerImg.src = author.image.url;

            const customerInfoNameH = document.querySelector('#customer-info-name');  // 이름 출력
            customerInfoNameH.src = author.username;

            const customerInfoActiveSmall = document.querySelector('#customer-info-active');  // 온/오프라인 출력
            customerInfoActiveSmall.classList.remove('avatar-offline');
            customerInfoActiveSmall.classList.add('avatar-online');
        }
            
    </script>

    <script>
        var accordions = document.getElementsByClassName("accordion");
        var i;
        
        for (i = 0; i < accordions.length; i++) {
          accordions[i].addEventListener("click", function() {
            this.classList.toggle("active");
            var panel = this.nextElementSibling;
            if (panel.style.display === "block") {
              panel.style.display = "none";
            } else {
              panel.style.display = "block";
            }
          });
        }
    </script>
    
    <script src="https://code.jquery.com/jquery-latest.js"></script>

        




</body>

</html>